# MySQL Configuration for Ultra-High Concurrency (2000+ users)
# Add this to your MySQL configuration file (my.cnf or my.ini)

[mysqld]
# ============================================
# CONNECTION SETTINGS (2000 concurrent users)
# ============================================
max_connections = 2000          # Allow 2000 simultaneous connections
max_connect_errors = 100000     # Increase error threshold
wait_timeout = 300              # 5 minutes for idle connections (faster cleanup)
interactive_timeout = 300       # 5 minutes for interactive clients
connect_timeout = 15            # 15 seconds connection timeout

# ============================================
# PERFORMANCE SETTINGS (Enterprise-Grade)
# ============================================
innodb_buffer_pool_size = 8G    # Cache for frequently accessed data (8GB for high load)
innodb_buffer_pool_instances = 8 # Multiple buffer pool instances for concurrency
innodb_log_file_size = 512M     # Transaction log size (doubled)
innodb_log_buffer_size = 64M    # Log buffer size
innodb_flush_log_at_trx_commit = 2  # Balance between performance and durability
innodb_flush_method = O_DIRECT  # Avoid double buffering

# ============================================
# THREAD AND CONNECTION HANDLING
# ============================================
thread_pool_size = 32           # Number of thread groups (increase for 2000 users)
thread_cache_size = 256         # Cache idle threads (doubled)
max_allowed_packet = 64M        # Maximum packet size for large operations

# ============================================
# QUERY CACHE (MySQL 5.7 and earlier)
# ============================================
query_cache_type = 1
query_cache_size = 512M         # Larger query cache

# ============================================
# FILE AND TABLE LIMITS
# ============================================
table_open_cache = 8000         # Keep more tables open (doubled)
table_open_cache_instances = 16 # Multiple cache instances
open_files_limit = 16000        # Increase file descriptor limit (doubled)

# ============================================
# INNODB OPTIMIZATION
# ============================================
innodb_io_capacity = 2000       # IO operations per second
innodb_io_capacity_max = 4000   # Max IO during intensive operations
innodb_read_io_threads = 8      # Read threads
innodb_write_io_threads = 8     # Write threads
innodb_thread_concurrency = 0   # Let InnoDB auto-tune (best for high concurrency)

# ============================================
# ADDITIONAL OPTIMIZATION
# ============================================
tmp_table_size = 128M           # Temporary table size
max_heap_table_size = 128M      # Heap table size
sort_buffer_size = 4M           # Sort buffer per connection
read_buffer_size = 2M           # Read buffer
read_rnd_buffer_size = 4M       # Random read buffer
join_buffer_size = 4M           # Join buffer
